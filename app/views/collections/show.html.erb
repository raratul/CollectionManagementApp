<div class="container mt-5">
  <div class="mb-3">
    <h1 class="mb-4"><strong>Collection Name:</strong> <%= @collection.name %></h1>
    <p><strong>Collection ID:</strong> <%= @collection.id %></p>
    <p><strong>Description:</strong> <%= @collection.description %></p>
    <p><strong>Category:</strong> <%= @collection.category %></p>
    <p><strong>Image URL:</strong> <%= @collection.image_url %></p>
  </div>

  <div class="mb-3">
    <%= link_to 'Add An Item', new_collection_item_path(@collection), class: 'btn btn-success' %>
    <%= link_to 'Edit', edit_collection_path(@collection), class: 'btn btn-primary' %>
    <%= link_to 'Back', collections_path, class: 'btn btn-secondary' %>
    <%= link_to 'Delete', @collection, method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger' %>
  </div>

  <div class="row mb-3">
    <div class="col-md-6">
      <label for="itemFilter" class="form-label">Filter by Item ID:</label>
      <input type="number" id="itemFilter" class="form-control" placeholder="Enter Item ID">
    </div>
  </div>

  <h5>Items</h5>
  <div class="table-responsive">
    <table class="table table-striped table-bordered">
      <thead class="thead-dark">
        <tr>
          <th>Item ID</th>
          <th>Item Name</th>
          <th>Tags</th>
          <% if @collection.custom_string1_name.present? %>
            <th><%= @collection.custom_string1_name %></th>
          <% end %>
          <% if @collection.custom_string2_name.present? %>
            <th><%= @collection.custom_string2_name %></th>
          <% end %>
          <% if @collection.custom_string3_name.present? %>
            <th><%= @collection.custom_string3_name %></th>
          <% end %>
          <% if @collection.custom_int1_name.present? %>
            <th><%= @collection.custom_int1_name %></th>
          <% end %>
          <% if @collection.custom_int2_name.present? %>
            <th><%= @collection.custom_int2_name %></th>
          <% end %>
          <% if @collection.custom_int3_name.present? %>
            <th><%= @collection.custom_int3_name %></th>
          <% end %>
          <% if @collection.custom_text1_name.present? %>
            <th><%= @collection.custom_text1_name %></th>
          <% end %>
          <% if @collection.custom_text2_name.present? %>
            <th><%= @collection.custom_text2_name %></th>
          <% end %>
          <% if @collection.custom_text3_name.present? %>
            <th><%= @collection.custom_text3_name %></th>
          <% end %>
          <% if @collection.custom_bool1_name.present? %>
            <th><%= @collection.custom_bool1_name %></th>
          <% end %>
          <% if @collection.custom_bool2_name.present? %>
            <th><%= @collection.custom_bool2_name %></th>
          <% end %>
          <% if @collection.custom_bool3_name.present? %>
            <th><%= @collection.custom_bool3_name %></th>
          <% end %>
          <% if @collection.custom_date1_name.present? %>
            <th><%= @collection.custom_date1_name %></th>
          <% end %>
          <% if @collection.custom_date2_name.present? %>
            <th><%= @collection.custom_date2_name %></th>
          <% end %>
          <% if @collection.custom_date3_name.present? %>
            <th><%= @collection.custom_date3_name %></th>
          <% end %>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="itemsTable">
        <% @collection.items.each do |item| %>
          <tr data-item-id="<%= item.id %>">
            <td><%= item.id %></td>
            <td><%= link_to item.name, item_path(item) %></td>
            <td><%= link_to item.tag, item_path(item) %></td>
            <% if @collection.custom_string1_name.present? %>
              <td><%= item.custom_string1_value %></td>
            <% end %>
            <% if @collection.custom_string2_name.present? %>
              <td><%= item.custom_string2_value %></td>
            <% end %>
            <% if @collection.custom_string3_name.present? %>
              <td><%= item.custom_string3_value %></td>
            <% end %>
            <% if @collection.custom_int1_name.present? %>
              <td><%= item.custom_int1_value %></td>
            <% end %>
            <% if @collection.custom_int2_name.present? %>
              <td><%= item.custom_int2_value %></td>
            <% end %>
            <% if @collection.custom_int3_name.present? %>
              <td><%= item.custom_int3_value %></td>
            <% end %>
            <% if @collection.custom_text1_name.present? %>
              <td><%= item.custom_text1_value %></td>
            <% end %>
            <% if @collection.custom_text2_name.present? %>
              <td><%= item.custom_text2_value %></td>
            <% end %>
            <% if @collection.custom_text3_name.present? %>
              <td><%= item.custom_text3_value %></td>
            <% end %>
            <% if @collection.custom_bool1_name.present? %>
              <td><%= item.custom_bool1_value ? 'Yes' : 'No' %></td>
            <% end %>
            <% if @collection.custom_bool2_name.present? %>
              <td><%= item.custom_bool2_value ? 'Yes' : 'No' %></td>
            <% end %>
            <% if @collection.custom_bool3_name.present? %>
              <td><%= item.custom_bool3_value ? 'Yes' : 'No' %></td>
            <% end %>
            <% if @collection.custom_date1_name.present? %>
              <td><%= item.custom_date1_value %></td>
            <% end %>
            <% if @collection.custom_date2_name.present? %>
              <td><%= item.custom_date2_value %></td>
            <% end %>
            <% if @collection.custom_date3_name.present? %>
              <td><%= item.custom_date3_value %></td>
            <% end %>
            <td>
              <%= link_to 'Edit', edit_item_path(item), class: 'btn btn-primary btn-sm' %>
              <%= link_to 'Delete', item, method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger btn-sm' %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const itemFilter = document.getElementById('itemFilter');
    const tableRows = document.querySelectorAll('#itemsTable tr');

    const filterTable = () => {
      const itemId = itemFilter.value.trim();

      tableRows.forEach(row => {
        const rowItemId = row.getAttribute('data-item-id');
        row.style.display = (!itemId || rowItemId === itemId) ? '' : 'none';
      });
    };

    itemFilter.addEventListener('input', filterTable);
  });
</script>
