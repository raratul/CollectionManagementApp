<div class="container mt-5">
  <h1 class="mb-4">Edit Collection</h1>

  <%= form_with(model: @collection, local: true, html: { class: 'needs-validation', novalidate: true }) do |form| %>
    <% if @collection.errors.any? %>
      <div class="alert alert-danger">
        <h4 class="alert-heading"><%= pluralize(@collection.errors.count, "error") %> prohibited this collection from being saved:</h4>
        <ul>
          <% @collection.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="mb-3">
      <%= form.label :name, class: 'form-label' %>
      <%= form.text_field :name, class: 'form-control', required: true %>
    </div>

    <div class="mb-3">
      <%= form.label :description, class: 'form-label' %>
      <%= form.text_area :description, class: 'form-control', rows: 3 %>
    </div>

    <div class="mb-3">
      <%= form.label :category, class: 'form-label' %>
      <%= form.select :category, ['Books', 'Signs', 'Silverware', 'Other'], {}, class: 'form-select' %>
    </div>

    <div class="mb-3">
      <%= form.label :image, class: 'form-label' %>
      <div id="drop-zone" class="drop-zone">
        <p>Drag and drop an image here or click to upload</p>
        <%= form.file_field :image, class: 'form-control', id: 'image-upload', style: 'display: none;' %>
      </div>
    </div>
  
    <%= form.hidden_field :image_url, id: 'image-url' %>

    <h5>Custom Fields</h5>

    <div class="mb-3">
      <%= form.label :custom_string1_name, 'Custom String Field 1 Name', class: 'form-label' %>
      <%= form.text_field :custom_string1_name, class: 'form-control' %>
    </div>

    <div class="mb-3">
      <%= form.label :custom_string2_name, 'Custom String Field 2 Name', class: 'form-label' %>
      <%= form.text_field :custom_string2_name, class: 'form-control' %>
    </div>

    <div class="mb-3">
      <%= form.label :custom_string3_name, 'Custom String Field 3 Name', class: 'form-label' %>
      <%= form.text_field :custom_string3_name, class: 'form-control' %>
    </div>

    <div class="mb-3">
      <%= form.label :custom_int1_name, 'Custom Int Field 1 Name', class: 'form-label' %>
      <%= form.text_field :custom_int1_name, class: 'form-control' %>
    </div>

    <div class="mb-3">
      <%= form.label :custom_int2_name, 'Custom Int Field 2 Name', class: 'form-label' %>
      <%= form.text_field :custom_int2_name, class: 'form-control' %>
    </div>

    <div class="mb-3">
      <%= form.label :custom_int3_name, 'Custom Int Field 3 Name', class: 'form-label' %>
      <%= form.text_field :custom_int3_name, class: 'form-control' %>
    </div>

    <div class="mb-3">
      <%= form.label :custom_text1_name, 'Custom Text Field 1 Name', class: 'form-label' %>
      <%= form.text_field :custom_text1_name, class: 'form-control' %>
    </div>

    <div class="mb-3">
      <%= form.label :custom_text2_name, 'Custom Text Field 2 Name', class: 'form-label' %>
      <%= form.text_field :custom_text2_name, class: 'form-control' %>
    </div>

    <div class="mb-3">
      <%= form.label :custom_text3_name, 'Custom Text Field 3 Name', class: 'form-label' %>
      <%= form.text_field :custom_text3_name, class: 'form-control' %>
    </div>

    <div class="mb-3">
      <%= form.label :custom_bool1_name, 'Custom Bool Field 1 Name', class: 'form-label' %>
      <%= form.text_field :custom_bool1_name, class: 'form-control' %>
    </div>

    <div class="mb-3">
      <%= form.label :custom_bool2_name, 'Custom Bool Field 2 Name', class: 'form-label' %>
      <%= form.text_field :custom_bool2_name, class: 'form-control' %>
    </div>

    <div class="mb-3">
      <%= form.label :custom_bool3_name, 'Custom Bool Field 3 Name', class: 'form-label' %>
      <%= form.text_field :custom_bool3_name, class: 'form-control' %>
    </div>

    <div class="mb-3">
      <%= form.label :custom_date1_name, 'Custom Date Field 1 Name', class: 'form-label' %>
      <%= form.text_field :custom_date1_name, class: 'form-control' %>
    </div>

    <div class="mb-3">
      <%= form.label :custom_date2_name, 'Custom Date Field 2 Name', class: 'form-label' %>
      <%= form.text_field :custom_date2_name, class: 'form-control' %>
    </div>

    <div class="mb-3">
      <%= form.label :custom_date3_name, 'Custom Date Field 3 Name', class: 'form-label' %>
      <%= form.text_field :custom_date3_name, class: 'form-control' %>
    </div>

    <div class="mb-3">
      <%= form.submit 'Update Collection', class: 'btn btn-primary' %>
      <%= link_to 'Back', collections_path, class: 'btn btn-secondary' %>
    </div>
  <% end %>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const dropZone = document.getElementById('drop-zone');
    const imageUpload = document.getElementById('image-upload');
    const imageUrlField = document.getElementById('image-url');
  
    dropZone.addEventListener('click', () => imageUpload.click());
  
    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone.classList.add('dragover');
    });
  
    dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
  
    dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone.classList.remove('dragover');
      const file = e.dataTransfer.files[0];
      uploadImage(file);
    });
  
    imageUpload.addEventListener('change', (e) => {
      const file = e.target.files[0];
      uploadImage(file);
    });
  
    function uploadImage(file) {
      const formData = new FormData();
      formData.append('file', file);
      formData.append('upload_preset', 'ml_default');
  
      fetch('https://api.cloudinary.com/v1_1/dxk4lzf7e/image/upload', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        imageUrlField.value = data.secure_url;
        dropZone.innerHTML = `<img src="${data.secure_url}" alt="Uploaded Image" class="img-fluid" />`;
      })
      .catch(err => console.error('Error uploading image:', err));
    }
  });  
</script>

<style>
.drop-zone {
  border: 2px dashed #007bff;
  padding: 20px;
  text-align: center;
  cursor: pointer;
  transition: background-color 0.3s ease, border-color 0.3s ease;
}

.drop-zone.dragover {
  background-color: #e9ecef;
  border-color: #0056b3;
}

.drop-zone p {
  margin: 0;
  font-size: 16px;
  color: #007bff;
}
</style>