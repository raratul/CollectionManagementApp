<h1 class="my-3 text-center">My Collections</h1>

<div class="mb-4">
  <%= link_to 'New Collection', new_collection_path, class: 'btn btn-primary' %>
</div>

<div class="row mb-3">
  <div class="col-md-6">
    <label for="categoryFilter" class="form-label">Filter by Category:</label>
    <select id="categoryFilter" class="form-select">
      <option value="">All Categories</option>
      <% ["Books", "Signs", "Silverware", "Other"].each do |category| %>
        <option value="<%= category %>"><%= category %></option>
      <% end %>
    </select>
  </div>
</div>

<table class="table table-striped table-responsive-md">
  <thead>
    <tr>
      <th>Collection ID</th>
      <th>User ID</th>
      <th>Collection Name</th>
      <th>Category</th>
      <th>Image URL</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="collectionsTable">
    <% @collections.each do |collection| %>
      <tr data-category="<%= collection.category %>" data-user-id="<%= collection.user_id %>">
        <td><%= collection.id %></td>
        <td><%= collection.user_id %></td>
        <td><%= link_to collection.name, collection %></td>
        <td><%= collection.category %></td>
        <td>
          <% if collection.image_url.present? %>
            <img src="<%= collection.image_url %>" alt="<%= collection.name %>" class="img-fluid" style="max-width: 100px;">
          <% else %>
            N/A
          <% end %>
        </td>
        <td>
          <%= link_to 'Edit', edit_collection_path(collection), class: 'btn btn-secondary btn-sm' %>
          <%= link_to 'Delete', collection, method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger btn-sm' %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const categoryFilter = document.getElementById('categoryFilter');
    const tableRows = document.querySelectorAll('#collectionsTable tr');

    const filterTable = () => {
      const category = categoryFilter.value;

      tableRows.forEach(row => {
        const rowCategory = row.getAttribute('data-category');

        let showRow = true;

        if (category && rowCategory !== category) {
          showRow = false;
        }

        row.style.display = showRow ? '' : 'none';
      });
    };

    categoryFilter.addEventListener('change', filterTable);
    userFilter.addEventListener('input', filterTable);
  });
</script>

<style>
  .table-responsive-md {
    overflow-x: auto;
  }
  .table {
    width: 100%;
    margin-bottom: 1rem;
    color: #212529;
  }
  .table-striped tbody tr:nth-of-type(odd) {
    background-color: rgba(0, 0, 0, 0.05);
  }
  .table thead th {
    vertical-align: bottom;
    border-bottom: 2px solid #dee2e6;
  }
  .table tbody + tbody {
    border-top: 2px solid #dee2e6;
  }
  .img-fluid {
    max-width: 100%;
    height: auto;
  }
</style>
